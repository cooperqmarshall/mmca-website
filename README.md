
# Mouse Mutant Cell Atlas 3D Data Visualization

This app visualized the cell x gene data from mutant and wild-type mice. Each cell's main and sub-developmental trajectories were determined using the [UMAP algorithm](https://umap-learn.readthedocs.io/en/latest/how_umap_works.html). The algorithm outputs x, y, and z values for each cell. When plotted, it provides insight into the clustering of cells in their trajectories.

### Table of contents

- [Build](#build)
- [Data Model](#data-model)
	- [Challenges](#challenges)
- [API](#api)
- [Install](#install)
- [TODO](#todo)

### Overview

The user can select which main trajectory to plot, filter by the strain of mouse (background) and mutation, then color the points by sub trajectory, total mRNA, mutant group, or expression of a certain gene.

![](https://lh3.googleusercontent.com/fife/AAWUweWoqgPW7yJ00bzEZaZNUTAnE9pu4vxLBvRgikEndEzCh4XwXJ0tG6tan8lzX_iPPFPJdOsd-IeELOK2PT28L-lVnfFS54fpthZFOfHCfNS4IT6hw0Bf66qosdfZ5wzJ41CxKEYMGTcD47U7ENBp3dDhLu2dz2qUYtDjv9AdiC-QngAd36UXFsu8TXb41n-2HYQspnklpjV5JhEQuyzBRoDv-DYESGofxoW_8p6_Aynj7r9Xx27t5DOJ4S__jqT1eOFRosjwEEPHtHxUA2tFxsXVGqIx8AF_-0PTAb5pngon9Hya79_dXYF4OpRjVZd89Sw5OHXz7_1oZIe95uG4Gm4_mLDfrP-GQWoL1FVT6eGBm2t9ODHzrDSXmUJ4Im6rqctZ6Do8uNYoRTnC0umfYLKWNjJP742OfCnmjjPJOZbrC_xiRsyLOf-iP7LyRK0os0JksjKCt0BFQ2fOtVYy2bRVryhSUrKn0WpAxehEEdK3u99ObrkZjGLPE5XhB_E26vTqNAiPGIc4hX1L1cZ4A1vSce_evCQ3dkA3lD15rUWAdZ8f7UCqhtz6lcw9q7Swc_a9dj6SJz8jOwYasXIlmr8LzeGqwPctECl-ujmg17zrE3a2QOoloyAFCZ_Jplv7iulH333whoRrkgqYPffsOI5y8whIUCu5q1yB8If0vrGuFJ3hRtMJM_nDc3NhEBAeRylxt6tLONjRq8L0LKbPVrb-Gyhuit-302b0Hxpfy368UUIZqlT3oEb55tlWUpQAjwRhVZsjEAi9qkZDW6pr6kojumpgp5Gnx4MiU9cY9qyUl1CvWJrI3wxQow7TFQMvO9ZgOsxZDn_EYItEO0jh6KI6SRAW0LkXU1jXPvNQpcGu-XRbrC_YKp4vxCZFvp2EbUWYUmGe1szn0BUIF12E5F4KLEAiDneSW59LFvDpZbtvQuMvJRvtEll-_bu4gqYLbIbazwjrGO6oLy5Xvc7K3dCsfvbHSzfx1I5bhbBFSdY8SUnVuhjm1JbPBvw38k2IvCnK3XCpqpYou0M0V75AFp7uQidWeDchE91uFFbvQe0MK1S-EXWIoQqRwXTwY3n5Dwm6drJUVe5IX4blk9iX3ZOs8PmFTFeJNSSSPT07hGC0o_sdvRZ11eKyskT53Uzts_l-sX7SqVXgCOI2h_3O30InIjOGa7LcEJUCbS69nJhMFh9edQD7ZnWCfEtJ38fwgHGp_MidVFpm_hUn9EoGDh_NfPeKViPxbutlknQdS4y_Jj8PrKuvWWie8Tb3PmPMlAjVQ11naBkCD9YQa1-IqF0kMEffj5sfpTAIngHHfFEkDlJdy21vX3iXjAc9ijO549XtJUxFdHjNhVCTSMwUv3J1E-30im0_LPVjyXXcM7vTajumEF2ZOHiwoLX8mmvTrb3qLf1c7etc2ARFPqgqO780LRUegKCF0498spFpdd0AF71UQdqzvmenk4HK1OvyAWUXiv5FAghTbMtbu3CEenvIBtECHfUv_2CHlwAwquNbVIBu3uYMBJcelEMKCvHXmdPPsMd9SwyS2p3GL-1D6eVLeDmQ9KO-jika3k0f0WPW1Ho2RZLkrHY7RWG75PiSt38EdRqgO_JmS6CdYn6g1aHlCjJaFvLzgG7wrcgA-zxMsRydnRwak80Ok-9wlXugJbI9SxhnrVwy3mW506ddkNg1au92Lc9cbyHQnGXSArJjxztUhuUCIujz3axN8zcq-TUAw8dUNUi63y9_3yj9un9UjSbK0040DcYhm5p41G8bG3E7s-_VDBs9rvD27lF0wY4_Ue5GTxtczIWlkIsCGFSxK17XAC31jPRWh18DVz5GskUJPgKVGzAacDr88miL-JvgmX-W3FtGrKcIY21WPcJ6O76Qat8DD9iGW8eKEBoCJDUbReferLJALuH67FhLDOLS7iRFLv4qiE8VqnTJduCDHIoXpaaGZMAfS3LOUPJJWX5QoLybzLzVQNINWXSSL4VWa6jiHfHITKn0wehZE3uJful2jbDGKWDddgLYHLPSn8I0eBKFuaUwzgSmL9fI7L_IRzcTHAUSju4c7JXCXLQAAAipWJiAbHR0LWugutxDs4y0RpjGQN0JWVJd_uCB0R4xgFJ-3Mn1h7lzj9ocPPPEb5yYMHhq1cwOttsSsXzdgNxlfeEXNj2SoA5hb9ezvRmbiwyQ28CyM-dlvQnqI-gVGtQI2QpLwBBm31T6a_Fvjq1Yi02CzE5a9XcKoSwWZorjL9fnYgJqy2FKevYQ7PnaG6CuYzDlxlYecIa24Yp5UR206XhD74IRgoeCimdY63aMmerrQLtHwZJ64LOnOE_eHqi4OPszK-mgHCZUUU3R3Y1iZy6C7V039JULxzGjDMPLLkxz-Kt7U4jdG8zu40Z_9u3B5BSQ_SO1YwM2wrAySa_j6b0Tm8BTzwjf1W_zz0qGXX7Rm9lEhaN1rpKcVnd3b2PMWtFxqgmb2XRj6eOCAp9qKLVCpY_wC4dFHIteAvE7FBuZniZPOKBpRxU73f_2MZivEB9pjlwITuusWU5ISBafDmkcwcM9gDrK_GpV6DybW3KRE1Ccfe7x2ixXOSMGLgXPkpRdlioKZutz-O7EOd10trRzNJ6PWAGKIqHv_3OTd0_3VKEXOMGtp8SN1SWOixJQSfpyN5bZ6Z7wYXPUpTOihT8WPA1N6OIG7wS60VicEOWz1XrLX9az9nNd7h4mQ0yUtRLZFL5jWEoJbn3dd9a41e7Og-Mc6NBPoL_MeKV9ihVBJzD9hbrbS5S2uEUeIwX4uCg72CBSlDroGhFo482FeEsaUzP4IOGjCxfi44lbOMeiRTsDTkQemInpIyLdkUvRYi2N0O--NeRUIt4MSA5qkyuBdwJP_QPLUJDESK9uiAn-GKg3cFStCJwAN7_vLalp-hWL1oYlzE_88KGNmXVfED1_Lwf7nbJlpnhOYTRsMoGqBcgvxkL5m7FqbxaPSBOJqMXLgMvrr7842sVuQHwjs8zlk1Tspcsx925mKBF3CiyclwKQMyiYEBZgJ9u3H44c808KQsHC3L8YkCo5gD9kUqvQAOscQLWtXkEnGeDSofwOyskHrMQ4S1gCdfu3tM71BBaTwuCCDFkNFMTo5DfuF8OIS0Py_VHXkZ5F9dFFU7NasQZRTzWoimOfZzKRHlneeQmWhQnixrl02QaZotU8ZLP9IcHSI7h6p4vhDWkxJM5fy7Jaqc4efSQTJTUqozNBgL-wpZgdSRlSlMDxbzyvSd5qhDTZJjYe9ErV4mM-Hxbzh3uj31kiuSGdoPYoyGVAaKjq5550K-zudLhKBMDtSN7X3pUHx3--nQjjqEIHHY4nxMtVBy0C12wdTB2STgi37X4FK3WrP30T1Eny70t1maIGAgg8mYANa_LvG2F8eRI8LIz0TIh4nUUkOUk5kyF9Ugz-9ZcvpGd1fP4oCjX0kq28oeoMWQIXgMMvtUTXBjKUneNDhWzLzUNmsTLelKcB2D1piHoG0B0Zx9_G1uFipzdlMwS-egkj4x4Vm7hEFcGXN3-Sc70k_cgK5u6SdXJEXXkmgAIE3IXKzQEaa6CDc6-9JQACMSKJkPbFH2UHz0adVFay3vTTdjzPBZu-DXNQhP-DuKCYnSbkIzsYgtwkKx7Z1vrq9YePlKe0XsjKff-g3zfOiVZs0MSgCnEOMTkdldj8Zf2XicH8TKHlcRpG8RDCK_9T1mJeGNHC6c9wQrIlDBCgLKLxgCMXfHRWUAGZsRhH4fU1=s600-w600-h338-no)

[Live Version](https://atlas.gs.washington.edu/mmca_v2/)

> ~3 second initial load

There are 2 plots to allow for a side-by-side comparison of different annotations or filter combinations. The camera's zoom, rotation, and pan are synced up between the plots for easier comparison.

## Build

The application uses the following tech stack:
- Sqlite3 (compiled with json1 extension)
- Express.js / Node.js
- Javascript
- Plotly.js
- [Skeleton css biolerplate](http://getskeleton.com/)

## Data Model

<img src="https://lh3.googleusercontent.com/fife/AAWUweU5YqMLWjfGVCAZCfwj4jfaoCx0B7TBsg-YM0N7O9Pq4EC2W5fOG_U7LbHKug31co9tuMpmr1HYvcFrm65UBt9ENLoRWXrPnLvjpV_bvrI_aDKVVG_9fZA8FWtPeo5RRYrFtpu81tWsGCullltznqvNPqzKsonsXOGuuM5ZCqR4VCpPCkC3Dpb7aMmOgx8Gkfid2vG8pKZvE8tUcxUDZXcDkckn3faKFgl9b9Zi-rSRZ_wu7KOOiB7rr-jxlzit0Qpin5dU-tlGsMhQRLa9YvE4j3UjH8YpHU6uybLzKz_rokZhfd2UrvBXDZ4ReFVjyTXDKw-gc2gojL3Drh5x1moKaaQVUhpE_VBERSKxAZMQN0lzb9ECfFeTNbGZjgJ0FlViWtuVhIICvXfTgVsRiXHHEUkmriNFuWETcrP8VTCbnOSqpM8rh-bapTublsM3yQ1iXMkrxjYzduJnPVNqzUnr7D6QyF06OFLfKsCZASjeNwZYtWv2IIip7DTs7lqjQ9uW6q4HJbAKd3_5W9nBHzIlAuSirh5CbgCG4Nz_2ektHInN9MeG3I92Xkk1TrGykoLvRZukZBTPa4mBjvG5hZScowVB4R-4OTeCzVGmHXlIF7C0xAGaw8zd1xqbjuK19zklmQ_y2xnmKTJNys3uF4RarsfnaJPrxO-AXYWWOadVbCMj493APORMN3tUYrym-rGkpWAn4SZoHmCHvXETdXGBVLy9tqzeT2qUv6414-ndp2hw8CWS1G4cuW0QF9_H_NLKibtK8lUtAmycoMYUzItl1BGw6SDvqM6vlTV8NoQqnwu6-7iyreflAuX7I0_LS0t21ANovauUagONpAmWxvBkRBhydd2xy57ki4w6fge099G-8Nvxd58JJWDOqrIWqFqHjr0QeYWh2-XQirdxcliddjEW532y5S06jMCufim0Lqk6qLNpHn2yRpF8j3yeSKUnYBwYKst71WEzzebCdgfYzHpxEapB-FV_hKL6HOoMyRRWWSdCJOsugTcnsvzKOsea78qr689hoNBjvA0UmVNpql1r-OSQCOIZxE1VYHdAg7Yxuhz_AkDqETumD0RA-yYUKykMpL9ai7nE6SCJt_hpNI4tuDC0ofMiLJvBT_nLMNQwL6nuFExjYusk007aDNrJdY36hKfmZzW-Ds661s-kt6jmLB6gYrFtugBNERRQfcNaX_GawELDws_NZAGBeg83EqrXeIC6zbzs6anJp8_9b5KE-2zC5RAmxAv3EH_uFa-spG9OeVEAYwiW3Ly3mU7gM6Nvh2S01HVl_XnKeh-e2gFVz2wdfD_6iYYPTG8XXKWq4thkhs0qop4-nQCgonYXZCI6OgkDtlxuDXMNBj4Zfjx0M8KIT-WNx0TWIEkJUKNcBSEt4-PF5k3cRC5Anwn70G4bM-W4m6DE5VaaK_jaFZ_huNpoCQPed4RC9qGJvBuUdgVjCA46Wf2B7SZm9xCBlOih3WXUg2d3bKCUIpAlxv99FMGMhVrQxUpwfGXv1JCz_cBgQg8K4pHBkxv9jwVm3AEq_ngjiXyPigOV9k_ZRL6dteSX5QVOV-jBZfin7etQLVoOgKRbxra0r9vuo7TGMP8YVYPudEZbOLICuAvLvJYpg3fA9c4pC8g-0O8Vs1AWrG-FuCIlX7LNYdXKodQXVSLfG4xgOwoB13N83APHfn8jbZ9CPUgaTgBsjKeAPOjIcbKEDwEBvOfqQRZdsxMaCAQKt2tPEf6ZB8S02rDqbEb8Zz-gSiiJRSyhk5lpTUvnp7zlt506guAO7FVMb5U5bCMP3doq_FybxBXbshEaiE_jUFLXgwcATFcvX_ZsRrXk_XgZF9d4tw-eSy69n8NlaVI2TlVARUYlTSth9WnC1X3A8tD7IdagKZz-UnIptG8nLJoQeOMedMsAIwq0QPWq9ATLtgSibDbuRL7uWMj_9k_sJUd7fsQaYlUt_j98Y85-NajxLYGt4RoDT_NlXMLSwia9603mTMMAtJRi1kA6kptEyDSKuibvYJA48njlZ0sH6D64i3a87WbPq1Zr4JkXpbArwsWyOCLnP8QFeaqEVDvhEn0eLXuhZgIF9QJ0-ASQGLb1PC-maKSigYFJ5bXzNE6yWvI7a-Gh1aYiqhixoehIGlemDg6u8_pMF-WLZ3j93NPh19CfqKJPZqshnGc_vAyYKQyZuvLqogx-9YyeEgXb8Sw62X3cQRnsw5Zxt_BZSfKn4G9PyjZsJ9q66Ub0QJ9iK7AcuJFv5oKWto5y59smTAekFhD-5HqlCsL3M8BOENGlCF5nWUkEggYtLJFL6jbEMkYS1Hws5PM71rYotdAEBjphUmVWO7TbeTafSD7t5jJAxMhtt_sQGAluaAboo3BKFHLxY9i0dZakkYCV9EREjLXmla6faYIj4hgyM7XX18eiH0ePO55GvXOjGeGXJzkiXzIF-Hg0yJbHFNKqp_G8180avF8UhKGWlib6hY-qSBjRCKgaaZjoiO2GgYLgyVqEbJ5oNx_vhyv26qKvTOlNC0u-Gdh0Krlv1HNEORhaa_BMyS_gWSsXBEFyFtqrul2HnFaw3hp5cgpG3m6shAv6M7Czta8eu_dgjM8U49F2ZlnhkWDatoiDj5TVcLuauxAglG-ZY-lHOPxz2uIJwNK_fb1eaq_PEtNxDrQi13UapvdC-asiXOQQ4oZPGWvN-JE-REVav6FyiL1Ft14EEytnI4GPH9xcfknMGr-hcW4kiWyU99c-sIx-BpkvDdI6VwxLwqOWB_2LRh1Nik2G0aBdw0_wvJd71BaeEe8IJyejBSyLtsMD69TZwM8-HXjJsATcbfOM9gHOFc3sQzlupoSxvESLu2qLOGC8EbZuxldiNYRiA3omfXFJhneYzWQHh79AApzw-FxBaiF59XLFV5ECVUg1gC6NipJLPXbs0l7b7XUDpVAqwEy8xXcDbOy5Ee6CnlnEBiIoT77LPLaUBaenTzqFi1glvV35AaWbzekCGtrgO42OWZx2HxRiSDcMDWlrxHezAAsroOiMsib_jxYftw9xKfu3THZSj1E8ZgHvFlWG_97oqD6Eo6U2X8uMeDOz7UFoTxO3v4MIPKd4jA75_hF8pEUY2VgoNcexs6-Ze7aJiW2x64LnAeaQwRvUNzaUkntbtHvf0AdPqpXCbAGEx-U4igRUw0lJmIoyL6SNeBc3xdZWubWYqplbnYnu4M-ANqAihERUDHL0bqlKkWUZWyp834EyLxDIHPcpLggJ8Qa8SLSvpodJKKsEJJSsu7pGk023blxqmJtjxowbaEMANoNVH0OWFLVUENwgzSKfzpoCu4c723YtHHRw4NW_XzeMPmSAfC4t2uvMzgJNStnGsBwIw4S7ZV43l64Cnh6hee3MTWLi3hMvjyGSReDEaJoOA_qkGg-yjhnaoYs-_ER6FkYGanxlYIkbUcZZD7cz9Glmf3_Jqvx1BLR8c7WCp6y7gsHAmpUjcd11anin8wdZaGYJqkvE9z432pRKLKWXAyEOxGu7UQlWHqLL5SnbfIqHBi7SN2K_unMYY33hFJVJUqSJxMUVtAgW_kIhwFNXdmbpFzpO5CAiVnkwGGQkFeNOlqptuRPdVnOkgWXUSbKlL9Ems77z6xeHP-IGZcrBbAEOOdlHi1CTFVdvXu6YIbtvff18sFSMXp1cS0rCnCYAYzuw-bWLNHyNzpCEeC1nT31G6m4EqhT4hep_E4GIrJYpX4LAhM791LgAvlbKEVHduf2LRhks=s788-w788-h570-no" width="600px">

The data model is comprised of two tables `cell` and `gene`. The `cell` table contains the UMAP coordinates as well as metadata for each cell. These attributes are used to filter or annotate (color) the 3d scatter plots. There is a compound index on columns (`main_trajectory`, `background`, `mutant`) because all plots will use some combination of these attributes to filter.

The `gene` table is indexed similarly with the addition of the `gene` attribute (`main_trajectory`, `background`, `mutant`, `gene`). The final column (`data`) is a json array with keys being the cell_id and values corresponding to that cell's gene expression.

	data = [ {"cell id 1": expression}, {"cell id 2": expression}, ... ]

	[
		{"MM-expr04-plate01-006.ACGCTTGATCCATTATCTA": 1},
		{"MM-expr04-plate01-073.TAGAGAGTATTAACTGGTTA": 2},
		{"MM-expr04-plate02-031.TAAGGTTCATCGTAGTTACC": 1}
	]

This model allows for a quick response to the front end given the application's multiple filters and large data scale.

### Challenges

The gene data was particularly challenging to construct a fast query around. This was primarily due to the number of cells and genes that were tested. The gene expression data was provided to me in a [sparse matrix](https://en.wikipedia.org/wiki/Sparse_matrix) format:

![](https://lh3.googleusercontent.com/fife/AAWUweWl9x8CPbkC-q0Fteo8YFCUgmlORG_sfGaGYIICCd0zfT6jC36NRRC50T5vE_sCdmjHHUJRney6OZGmyZA6kHXBYVFASsXk5QqHEa9Q68jJ33mD4UbFEpmTMEbXr5gr9bCqDXS10cJRjEoZ3B4nhM0POmImkCWR4V0K92D-sq7oFzvGkgwl_IYwyJwpkCsKNIUr17Qbs27OUMPtBAS7k3BVC8dPpi6awlryiPrge8ptzfDPna9jQV6fmZGYktOrEmzhg1rXKgFKza51iow-T7FLYMGU6C7dK6t8NgmLaiAiWgAD6x_LwoAUkCohb6FpD7pE7FyasLhCUvvgwyQvRlNcup5TZ1Rka0Uf2FK0EGT37kCt__yIwCYpzDPr99vsc_8h6PiLnWi_CoRLGy1mXv3bc2aEh5MKmGtK3gyHzEtwyH0IgQhYMHF7eBANykF7OYxE1PRAiCU-VoW2Y58Y8zLhA9LQZ9Hd3QBcBj4hZNTGfsI9ECVORZFAmYn2t7syMpUNyRApS560eTiG_Nz2G0guWQcF0an3OoCjQVJakbQw-RuwL65nbZvKkbft47bEexhComKsmdXd9Ht0St6K8aXWl-9_DNV1kHMpD3k-AWshAlPNlZSfsi7tQpvLZdW0P47QdJ4qhSY9CFYcqmiMC60zBJG66qMb2IjddpB1kd9EI79RA4ffczNpwBS8ZS8J3vjynW0uWnOvq9QfXPXaRYhi-TYo7mUjgKqy-j0ZNjrqXbCWYLlb0BWuulcvsTrACZwf6iYqNMupy6xS2CWJJJQzqShWux3dvnahZEFxTq6gTUeGAHm6ZQsICIJpSulmWtbZN-C6L-2S-ZtOQQAszXK9Yi4fJaPCIQyS1Onuk0VBPdv9VvmRlbhbO-od5_F5hxGB7hxjy32E43nOOeM23VJIq_WQzhh7qceMggQUefL__r6j-Doh033I39jF0Y6yrchybYqNM0XOw1D5yQbarCdAcD9fm_WGMH6ZAV1KeDjt00pIQfvBCVd5o8GGiSUecknfDBVCqEcQSxrtYIFXdiiptU8wFMD5H9aK2XmapPRD4kdRSD5k3hhEgx1pkoSv-2YVU6jvZlOT8ikyNuB6oIc-qnEucVBdh7sejgtqvNCulJ77RaYPErP35LKUUJTLA6Ep_jxGuhLH99zv6NHSoDvdZHLyrZtVvT86gDfw4kv0jAg4yAB20I0h6FRpgczQpcYsm6xMYxC9e2sCdohwnGW9QmRRZCEuj9uAbUMCT7a62uLUd2tSLXALvGRZ15ILWRa_uwI-X-KZwAYnkYuBu_1FX8L9GYfYj9rHbhfYqfet7xODQmLuww1WlnKI074vZzYdOMkimfxUXB28Lk8n2hdJiaXVpqhsKDLacKEvWa7eodOIRho36iamwdDJxCTFj5G3-eengHUoVkn923WqkX6BWg7p4wrTSH6R3UvFKlUTbp9U5Dx-sJZP2VgIuummhhx24zmAD98I_M78_1zsUjDM576I0aHcRMyS4RXUw4LfvN_p_ebsk3ID9wHLdoXZNlt-nsZbkP4Kh-gQzHTpTND0jlME_HyoV_I3h-vcmXLmvW5R7dwVo0VCDNVreTcyfeSir4ZgknlylH-MvQTo-O0kJfLZ-govPpsnj50sy1Wm4T3rm-_UGPs6DngIn6mZcfGBTFhZSiIjmW2EVsS5RugulZnrj9xKsSjkJWsPvJHSSKfYD_0sHQOVfyzenATf2trmUiFjXWPnGLsDURyOuZ1Y-9URNuTibPqV8g6SmHGBNLH5ixwVxzvqAN_Rl-dPDNZZN39W81pWpAoFVUFGae20C87VI7E1qlNNDJ7ihQnxtLYhgzsmzZpGNpLEoragnlM4SdArCBVJguq44u7cOZezorXLhOnGK7FjZMrqWVoGUJA79HOkN6hTTZHj-yU_n_1QQKVOcRj8vYBv_pzgmCPH55YR9TtHiOUx4MKkDL0tbjB_9TiLibu-QmEDeh8zpf4QVA9pGd7JY-h5hBPHBZSM9dkRTz_pbVf-e-KpRN8jIm8tPPN381ZiWMgU2NAtbcu8vkJZz9-X1vrZGvMs_yS6FifQJ-2x7QXwMjDswdvu2v_0Gm9tXcuegxN5n0Oc4_qniczbvaE7p5CNNvwmJ8xlnxhGPh39qtHUuz-LhvjDuv1PStp_2F6DD5e1iF6YeiQeW3mz4IDnllk1cWVTL0y4rUh1xuZ8F0YggYlFOR_UpDXD98Ahbb3if10cy9QjPimXCe5ML8lPG_aupRQv6Ds-SZ7saPx99C_wJa_MCglk-ENUAFGY6LwyLXUnCfzDDHvTrbLRAQXTdIBJqXkZDHYCbIwWyhG20RwVLzm67IkCRURzInNdZgDKOdXA3CzWLZXA5-OSdtC0rktLWthX_9bwWBrWPKI2XLJRChsqDcJVUhccAJKJNWDqIN6owi1MjLK66KuK-6Nl8stBc7zXXVIeiVn9j697nUOUi3sA2_AjelQY-S7a3gv8ZaWlEhfwJWkj7bH6Pv8SWKehkY5UW1x2_GqtQyTGF_3GXWvIEZeiGJDapx7Aq--mXGWHRp8rRxQpBlodtbXHHDNEszcaw5kAKW0GEH0uLRDL4vxJ_ZLNtOUeUIqi4IoudlnV3rCIxPp_vMFphSjWzfQ2flFd9gIBxmYBbW9SDgUtZhrAu5FlwpEmh3M3gnenYRjSZOfZ8VfOD3T7dVP7B_1kOQsmBIwwXFP2A0Tku4q8q_rsMBkh2Wm07KeFVcpz-N_jWglmIHM2Y9G9R3d8cNs5CkW2B-vTg07zcxbB9BEB-QtB53rVRfVlTCEh9CUjIm3XUlXupEELCMwu3_Fd2LctXhDi9HGDBjk7pMopSJsl8MwlHvF_2oUIAknKQT0xPLz3fmFlruxMG8DkkNUR4yf9WJJg5vhRcXn1wZfIu44aJx-UOr4KQ8QHM831kQNW2O8j7JKOPcxY8NEwfM90wJOSHVuPJazBShjGcexAohuBmBTHEIEau-JBOVxk-V7BL8rj92pJEEtYQJgKNx9kW0Wbc9n8gD9SRvqATkJd5sS_WgMpalAR4HxqWRdVKvdwa3RIh0z2QyuMSch1H-TtToPWGcFDZTFHPHNoJLroE6sK66bw646GCGGQ_0tQCGoNOZIlYqtIhE2YzR8g1vOAWO9ifH5592bmf_1WY8zPD7dVvKIdoZsk2aNFvIAIK3-_55Z8Homji37s3g8U2UU_JW0NxSBlGpupZyFIc3MexjeA_hRtABmnHjNtw8P2H_zighjB--vxaUzthTriSXNg7v0jrR72qXaZ-rKX_UxDWBjqFfWFVcDVWeJd3nYzlD5fPtBEqFgdOATQz8QKz4fiEVDsmNMIq8DiMYEYSsmDhqCroEd7rgoe8gs2Y0OB1xpOnwI8_fDOXvXa_HrAPRzhY7rtz05bhgi16xu-KvrMysvD0DArjP_Z-1-jeUNiBXCZXmmyAXhIdWNb2RtrQLECU0NLx1McgrCasDGlD9WwPdpe18FOOzTzi5ACSqSPnQY-aj123Inw6BNMsHj-hdvTp5RD7DC0bvDc5IOycAIcFBNcbH_f_eVHzXzAVdg85x3wW7nxnM0MDYzT9t1r1Pzm3wKy98dA4pV7teCRQ0MQihlqET0L6FbzlErANXJWi6H_XxjAEZ-eWtauNSKgpFZseAdLEGXjzKQIX8DRr6Jy45OtZUQ9rqbQOm_9Dk4J4FooNvQYhfdYEH1qomS4b7FN_NtWlZ0Wl49fSnV3qSzQkq5URS1znGIe=s773-w600-h600-no)

There are in total 41,380,594,311 entries in the matrix with 1,068,417,870 non-zero entries. My first idea was to use 3 columns to represent the matrix: column index, row index, value, or in this case `cell_id`, `gene`, `expression`. I set up a one-to-many relationship with the `cell` table on `cell_id` and added an index on (`cell_id`, `gene`) This resulted in a table with ~1 billion rows and very slow queries. Rethinking the data model and remembering json worked with relational databases lead me to the current data model which performs much faster.

## API

Express.js serves both the front end and back end for this application. There is one route to interact with the database. The database connection is read-only.

#### /mmca_v2/data

query parameter keys and value options:

- backgorund
	- G4
	- FVB
	- C57BL6
- trajectory
	- Haematopoiesis trajectory
	- Cardiomyocyte trajectory
	- Endothelial trajectory
	- Mesenchymal trajectory
	- Neural tube and notochord trajectory
	- Epithelial trajectory
	- Neural crest (PNS neuron) trajectory
	- Hepatocyte trajectory
	- Melanocyte trajectory
	- Neural crest (PNS glia) trajectory
	- Myoblast trajectory
	- Myotube trajectory
	- Olfactory sensory
- mutant
	- Depends on the trajectory and background combination. Check the live version's selector for values

The next two are mutually exclusive
- gene
	- See /public/js/genes.js

OR

- annotation
	- sub_trajectory
	- total_mRNA
	- mutant_rt

## Install

You need to have a build of sqlite with the [JSON1 extension](https://www.sqlite.org/json1.html) enabled.

First check if your sqlite3 has JSON1 enabled: [Test JSON1](#test-json1) If it is not enabled, you need to compile sqlite3 and use the built-in compile-time option to enable this extension.

#### Configure Sqlite3

1. Download the amalgamation from https://www.sqlite.org/download.html

2. I used the following command on CentOS to compile sqlite3 with the JSON1 extension but things may differ between OS

		gcc -Os -I. -DSQLITE_THREADSAFE=0 -DSQLITE_ENABLE_JSON1 -DSQLITE_ENABLE_EXPLAIN_COMMENTS shell.c sqlite3.c -ldl -lm -o sqlite3

Check out the docs for more info: https://www.sqlite.org/howtocompile.html

#### Test JSON1

To test if you have the json1 extension enabled, run your compiled sqlite3 and try following select statement:

	sqlite> select json('{"this": "is", "a":["test"]}');
	{"this":"is","a":["test"]}

If there are any errors, something went wrong with the sqlite compilation.

#### Download dependencies

	npm i

> You need to build the sqlite3 npm package from source using your compiled sqlite3 with JSON1 enabled
> 
	npm remove sqlite3

	npm i sqlite3 --build-from-source=path/to/sqlite3/with/json1

#### Configure app

1. Download a lightweight version of the database here

2. Edit `public/js/global.example.js` with the correct path to the database file

3. Save as `global.js`

#### Start server

	node app.js

## TODO

- Allow users to use their own cell x gene data
	- This will need to be implemented as a separate application
- Add mutant scores as an annotation
- Upgrade to posrgres
- Use webgl instead of plotly
- Use SPA framework for front end (if more front end flexibility is needed)
- Intro Page
	- Description
	- Link to paper
	- Link to the Data tab
	- link to download tab
- Download Page
	- sections?
	- look at the previous cell atlas
- Trajecotyr order
	- order by size
- Increase size
- Gene expr normalization
- log normalized expression
- tool tips
	- Not imediate hover
